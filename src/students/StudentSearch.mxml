<?xml version="1.0" encoding="utf-8"?>
<mx:Form xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" width="400" height="300" xmlns:services="services.*"
		 creationComplete="init()">
	<fx:Script>
		<![CDATA[
			[Bindable]public var bldgId:String; 
			public var changeTimer:Timer = new Timer(1000, 1); 
		    private function init():void { 
				changeTimer.addEventListener(TimerEvent.TIMER, onTimerEnd); 
			}
			
			private function onTimerEnd(event:TimerEvent):void { 
				searchSvc.send({q:searchStr.text, bldg_id:bldgId}); 
			}
			
			
			private function onChange():void { 
				if (changeTimer) { 
					changeTimer.stop(); 
					changeTimer.reset(); 
					changeTimer.start()
				}
			}
			
			public function get selectedItem():XML { 
				var x:XML; 
				if (searchGrid.selectedItem) { 
				  x= XML(searchGrid.selectedItem); 	
				}
				else {
				  if (searchSvc.xml.student.length() == 1) { 
					  x = searchSvc.xml.student[0]; 
				  }
				}
				return x; 	
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		
	</fx:Declarations>
	<services:DataService id="searchSvc" defaultService="StudentSearch" defaultMethod="execSearch" /> 
	<mx:FormItem label="Search" >
		<s:TextInput id="searchStr" width="296" change="onChange()"/> 
	</mx:FormItem>
	<mx:FormItem height="100%" width="100%">
		<mx:DataGrid id="searchGrid" width="100%" height="100%" dataProvider="{searchSvc.xml.student}">
			<mx:columns>
				<mx:DataGridColumn headerText="First" dataField="@first_name"/>
				<mx:DataGridColumn headerText="Last" dataField="@last_name"/>
				<mx:DataGridColumn headerText="Grade" dataField="@grade"/> 
			</mx:columns>
		</mx:DataGrid>
	</mx:FormItem>
</mx:Form>
